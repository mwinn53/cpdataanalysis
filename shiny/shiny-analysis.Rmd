---
title: "cpsbanalysis"
author: "mw"
date: "January 26, 2018"
output: html_document
runtime: shiny
---

```{r input, echo = FALSE, message = FALSE, warning = FALSE}
  
  knitr::opts_chunk$set(fig.width=10, fig.height=5, echo=FALSE, warning=FALSE)
  
  require(ggplot2)
  require(psych)
  require(dplyr)
  require(scales)
  require(grid)
  require(gridExtra)
  
  imagenames <- c("Windows Server 2008", "Ubuntu 14", "Windows 10")
  teams <- c("10-4784", "10-4785")
  
  colMax <- function(i) sapply(i, max, na.rm = TRUE)
  
  files <- list.files(path=".", pattern="*.csv")
  
  data <- lapply(files, read.csv, sep=",", header=TRUE, stringsAsFactor = FALSE)
  data <- do.call("rbind", data)
  
  # Clean up the columns
  names(data)[names(data) == "X"] <- "line"
  
  names(data)[names(data) == "X.Warn"] <- "warn"
  data$warn <- as.factor(data$warn)
  
  data$OverallPlace <- as.integer(data$OverallPlace)
  
  data$Division <- as.factor(data$Division)
  
  data$OverallPlace <- as.integer(data$OverallPlace)
  
  data$PlayTime <- as.difftime(data$PlayTime, format = "%H:%M", units = "mins")
  
  names(data) <- gsub(x = names(data), pattern = "_state_gsms.", replacement = ".")
  names(data) <- gsub(x = names(data), pattern = "_state_sms.", replacement = ".")
  
  # Summarize the images and total artifacts
  totals <- colMax(data[names(data)[grep(".Found$", names(data))]] +
           data[names(data)[grep(".Remaining$", names(data))]])
  names(totals) <- gsub(x = names(totals), pattern = "Found", replacement = "Total") 
  names(totals) <- unlist(lapply(strsplit(names(totals), "_"), `[[`, 1))
  
  # Formats all of the "<image>.Time" columns into minutes
  data[names(data)[grep(".Time", names(data))]] <- sapply(data[names(data)[grep(".Time", names(data))]], as.difftime, format = "%H:%M", units = "mins")
  
  # Coerce all of the "<image>.Warn" vectors to factors
  data[names(data)[grep(".Warn", names(data))]] <- lapply(data[names(data)[grep(".Warn", names(data))]], as.factor)
  
  # Add the completion ratios to each team's scores
  data$Server2008.Completion <- data$Server2008.Found/totals[1]
  data$Ubuntu14.Completion <- data$Ubuntu14.Found/totals[2]
  data$Windows10.Completion <- data$Windows10.Found/totals[3]
  
  data$State <- as.factor(data$State)
  data$StatePlace <- as.integer(data$StatePlace)
  data$TeamName <- as.factor(data$TeamName)
  data$TeamNumber <- as.factor(data$TeamNumber)
  data$Tier <- as.factor(data$Tier)
  
  row.names(data) <- NULL
  
  # Remove unused columns (i.e. in this particular analysis)
  data$Tier <- NULL
  data$Division <- NULL
  data$Ubuntu14.Total.1 <- NULL # Remove errant duplicate column
  
  top50 <- droplevels(data[data$OverallPlace >= 1 & data$OverallPlace <= 25,])
  ga <- droplevels(data[data$State == "GA",])
  cc <- droplevels(data[data$TeamName != "",])

```

# Analysis of Cyber Patriot State Round scores

## INTRODUCTION
The National Youth Cyber Defense Competition is the centerpiece of the Cyberpatriot program. The competition puts teams of high school and middle school students in the position of newly hired IT professionals tasked with managing the network of a small company. In the rounds of competition, teams are given a set of virtual images that represent operating systems and are tasked with finding cybersecurity vulnerabilities within the images and hardening the system while maintaining critical services. Teams compete during a six hour period for the top placement within their state and region. The state competiion took place on January 19-21, 2018. The top half of teams in each state progresses to the state semi-final round (February 9-11), where the top 3 teams advance to the National Finals Competition in Baltimore, MD. The top national teams can earn national recognition and scholarship money.

Evans Middle School started competing this year with two teams of 5 students each. The Evans Middle School teams are the ````Tax Collectors```` (```10-4784```) and ```Users Unknown``` (```10-4785```). They competed against a total of ```r nrow(data)``` teams in the nation, and ```r nrow(ga)``` in Georgia--```r nrow(cc)``` of which are from other Columbia County schools. 
The following analysis compares both teams' performance among the national, state, and local results from the State round in order to develop strategic insights. Such insights can influence the coach and mentors to focus training materials in a way that increases the teams' competitiveness.


## DESCRIPTION 

During each round, the unofficial score are delivered in near-real time via the competition website (```http://scoreboard.uscyberpatriot.org/```). The main page displays a table of key competition data, such as current score and elapsed time. In each row on the table, there is a secondary link that provides supplementary data, such as a the number of artifacts found, artifacts remaining, and score per image as well as details on any penalties.

The state round featured ```r length(names(totals))``` images: ```r imagenames```. The table below shows the total number of artifacts available on each image.

```{r imagesummary}
  print(totals)
```

## SCORING ANALYSIS 

The overall results from the Evans Middle School teams are in the table below. _Note that the units for ```PlayTime``` fields are elapsed minutes since the scoring engine on the first image was initialized._

### Team Results

```{r myteamresults}
  teams <- c("10-4784", "10-4785")
  myteams <- droplevels(data[data$TeamNumber == teams,])
  
  vars <- c("TeamName", "ScoredImages", "StatePlace", "OverallPlace", "CurrentScore", "PlayTime")
  print(myteams[vars], row.names = FALSE)
  
```

In further detail, here are the team results for each of the images.

#### Windows Server 2008:

```{r myteam2008}
  vars <- c("TeamName", "Server2008.Found", "Server2008.Completion", "Server2008.Score", "Server2008.Time")
  disp <- myteams[vars]
  names(disp) <- c("Name", "Found", "Complete(%)", "Score", "Time(min)")
  print(disp, row.names = FALSE)
```

#### Ubuntu 14:
```{r myteamubuntu14}
  vars <- c("TeamName", "Ubuntu14.Found", "Ubuntu14.Completion", "Ubuntu14.Score", "Ubuntu14.Time")
  disp <- myteams[vars]
  names(disp) <- c("Name", "Found", "Complete(%)", "Score", "Time(min)")
  print(disp, row.names = FALSE)
```

#### Windows 10
```{r myteamwindows10}
  vars <- c("TeamName", "Windows10.Found", "Windows10.Completion", "Windows10.Score", "Windows10.Time")
  disp <- myteams[vars]
  names(disp) <- c("Name", "Found", "Complete(%)", "Score", "Time(min)")
  print(disp, row.names = FALSE)
```


### Competition Results

The analysis in this section presents the overall results of the State round. Then, the results of the Evans Middle School teams is compared against the national, state results, and the local community results.

#### Top `r nrow(top50)` Teams
```{r topnsummary}
  # Extract the subsets of interest
  nteams <- nrow(data)

  vars <- c("TeamNumber", "TeamName", "OverallPlace", "State", "StatePlace", "CurrentScore")
  print(top50[vars], row.names = FALSE)
```

### Scores from Georgia schools
_NOTE: Teams with a "Team Name" are the Columbia County schools with Cyberpatriot teams._
```{r statesummary}
  vars <- c("TeamNumber", "TeamName", "StatePlace", "OverallPlace", "CurrentScore")
  print(ga[vars], row.names = FALSE)
```

### Score Comparision

The graphs below shows the distribution of teams per state, followed by a summary of each state's scores. The nuxmbers along the bottom of the x-axis note the number of teams in each state. The horizontal dashed line represents the national median score (`r median(data$CurrentScore)`) Georgia is highlighted in blue for easy recognition.

```{r stateteams}
  stteams <- data.frame(table(data$State))
  names(stteams) <- c("State", "Teams")
  
  p1 <- tableGrob(head(stteams[order(-stteams$Teams),],10), rows = NULL)
  
  p2 <- ggplot(stteams, aes(x=reorder(State, -Teams), Teams)) +
      geom_bar(stat = "identity") +
      labs(x = "State", y = "Teams")

  grid.arrange(p1, p2, ncol = 2, top = "Team Desnsity by State", widths = c(1, 4))
```

_This graph highlights the Evans Middle School teams' (blue) performance in relation to the teams in Georgia (grey) as well as the teams in Columbia County (red)._

`**[RQ]** How does the per-state denisty of teams affect their overall competitiveness?`
`**[A]** Look at correlation between Teams per State vs. Overall Score`

```{r score}
  give.n <- function(x){
  return(c(y = -10, label = length(x))) 
  }

  p1 <- ggplot(data, aes(State, CurrentScore)) +
    geom_boxplot() +
    ggtitle("Overall Scores by State") + labs(x = "State", y = "Score") +
    stat_summary(fun.data = give.n, geom = "text", position = position_dodge(width = 1), fun.y = median) +
    geom_boxplot(data=data[data$State=="GA",], aes(State, CurrentScore),fill="blue") +
    geom_line() + geom_hline(yintercept = median(data$CurrentScore), color="blue", lty=2)
    
  p2 <- ggplot(data=data[data$State=="GA",], aes(State, CurrentScore)) +
      geom_boxplot(outlier.size=0) +
      geom_jitter(aes(State, CurrentScore),
             position=position_jitter(width=0.1,height=0.1),
             alpha=0.6,
             size=3,
             show.legend = FALSE) +
      geom_jitter(data=data[data$TeamName != "",], aes(State, CurrentScore),
             position=position_jitter(width=0.1,height=0.1),
             alpha=0.6,
             size=3,
             show.legend = FALSE,
             color = "red") +
      geom_jitter(data=data[data$TeamNumber == teams,], aes(State, CurrentScore),
               position=position_jitter(width=0.1,height=0.1),
               alpha=0.6,
               size=3,
               show.legend = FALSE,
               color = "blue") +
    xlab("Georgia Teams") +
    ylab("Score") +
    ggtitle("GA Teams")
    
    grid.arrange(p1, p2, ncol = 2, top = "Score Analysis", widths = c(5, 1))
```


## COMPLETION ANALYSIS
```{r completion}
  # d <- data[,31:33]
  # ggplot(d) +
  #     geom_boxplot() +
  #     ggtitle("Overall Scores by State") + labs(x = "State", y = "Score") +
  #     xlab("Image") +
  #     ylab("%")

```

## IMAGE SCORE ANALYSIS







## OVERALL:
* How are image scores distributed among common total scores?
* How do penalties influence the image/total scores?
* How much time do team spend on images with common scores?



This R Markdown document is made interactive using Shiny. Unlike the more traditional workflow of creating static reports, you can now create documents that allow your readers to change the assumptions underlying your analysis and see the results immediately. 

To learn more, see [Interactive Documents](http://rmarkdown.rstudio.com/authoring_shiny.html).





## Inputs and Outputs

You can embed Shiny inputs and outputs in your document. Outputs are automatically updated whenever inputs change.  This demonstrates how a standard R plot can be made interactive by wrapping it in the Shiny `renderPlot` function. The `selectInput` and `sliderInput` functions create the input widgets used to drive the plot.

```{r eruptions, echo=FALSE}
inputPanel(
  selectInput("n_breaks", label = "Number of bins:",
              choices = c(10, 20, 35, 50), selected = 20),
  
  sliderInput("bw_adjust", label = "Bandwidth adjustment:",
              min = 0.2, max = 2, value = 1, step = 0.2)
)

renderPlot({
  hist(faithful$eruptions, probability = TRUE, breaks = as.numeric(input$n_breaks),
       xlab = "Duration (minutes)", main = "Geyser eruption duration")
  
  dens <- density(faithful$eruptions, adjust = input$bw_adjust)
  lines(dens, col = "blue")
})
```

## Embedded Application

It's also possible to embed an entire Shiny application within an R Markdown document using the `shinyAppDir` function. This example embeds a Shiny application located in another directory:

```{r tabsets, echo=FALSE}
shinyAppDir(
  system.file("examples/06_tabsets", package = "shiny"),
  options = list(
    width = "100%", height = 550
  )
)
```

Note the use of the `height` parameter to determine how much vertical space the embedded application should occupy.

You can also use the `shinyApp` function to define an application inline rather then in an external directory.

In all of R code chunks above the `echo = FALSE` attribute is used. This is to prevent the R code within the chunk from rendering in the document alongside the Shiny components.



